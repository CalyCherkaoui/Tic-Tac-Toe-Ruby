#!/usr/bin/env ruby
require './lib/player.rb'
require './lib/board.rb'
require './lib/game.rb'

# Initialize the game

player1 = Player.new('O')
player2 = Player.new('X')

game = Game.new(player1, player2)

puts game.welcome_message

# create player1 object
puts game.enter_player(1)
player1.name = gets.chomp.capitalize
puts game.assign_totem(player1)

# create player2 object
puts game.enter_player(1)
player1.name = gets.chomp.capitalize
puts game.assign_totem(player1)

# Start game

board = Board.new
puts game.display_grid(board.grid)

validate_pick = proc do |pick, array|
  until board.pick_valid?(pick) && board.not_picked?(pick)
    if !board.pick_valid?(pick)
      puts game.pick_not_valid
      pick = gets.chomp.to_i
    elsif !board.not_picked?(pick)
      puts game.already_picked
      pick = gets.chomp.to_i
    end
  end
end

turn = proc do |player|
  puts game.pick_number(player.name)
  pick = gets.chomp.to_i
  validate_pick.call(pick, board.grid)
  player.picks_array << pick
  board.update_grid(pick, player.totem)
  puts game.display_grid(board.grid)
end

loop do
  turn.call(player1)
  break if player1.winner? || board.grid_filled?

  turn.call(player2)
  break if player2.winner? || board.grid_filled?
end

# end of the game
if player1.winner?
  puts game.the_winner(player1.name)
elsif player2.winner?
  puts game.the_winner(player2.name)
else
  puts game.draw
end
